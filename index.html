<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Parallax Video</title>
<link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet">
<style>
  body, html {
    margin: 0;
    width: 100%;
    height: 100%;
    overflow-x: hidden;
    overflow-y: auto; /* enable vertical scrolling */
    background: #000;
    cursor: default;
    perspective: 1100px; /* enable 3D tilt perspective for the video */
    scroll-behavior: smooth; /* smooth navigation to anchors */
  }

  /* Fullscreen video wrapper */
  .video-wrapper {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    pointer-events: none; /* allow interactions to pass through */
    z-index: 0;
    transition: opacity 1s ease;
  }

  /* The video will use its intrinsic size (real pixels) and be centered; wrapper will crop slightly.
     A small scale is applied in JS when needed to ensure a slight crop and avoid tiny slivers. */
  #bg-video, #bg-video2, #bg-video3 {
    position: absolute;
    top: 50%;
    left: 50%;
    width: auto; /* use intrinsic width */
    height: auto; /* keep aspect ratio */
    transform: translate(-50%, -50%) rotateX(0deg) rotateY(0deg) scale(1);
    transform-origin: center center;
    will-change: transform, opacity;
    transition: opacity 1s ease; /* smooth fade when switching videos */
    z-index: 0;
    pointer-events: none;
  }

  /* Use this for any content that should appear above the video */
  .content {
    position: relative;
    z-index: 2;
    margin-top: 100vh; /* keep the homepage (video) as the first full-screen view */
    pointer-events: auto;
  }

  /* Info section hidden by default and revealed when the user scrolls */
  .info-section {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 650ms cubic-bezier(.2,.9,.2,1), transform 650ms cubic-bezier(.2,.9,.2,1);
    pointer-events: none;
    will-change: opacity, transform;
  }

  .info-section.visible {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  /* Jersey font utility (fallback to sans-serif if not available) */
  .jersey-10-regular {
    font-family: "Jersey 10", sans-serif;
    font-weight: 400;
    font-style: normal;
  }



  /* Quick links bar at top of homepage */
  #quick-links {
    position: fixed;
    top: 14px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    align-items: center;
    padding: 8px 12px;
    background: rgba(20,20,20,0.36);
    color: #fff;
    border-radius: 999px;
    z-index: 6;
    backdrop-filter: blur(6px) saturate(1.05);
    -webkit-backdrop-filter: blur(6px) saturate(1.05);
    box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    pointer-events: auto;
    font-family: sans-serif;
  }
  #quick-links a {
    color: #fff;
    text-decoration: none;
    padding: 6px 10px;
    border-radius: 8px;
    font-size: 14px;
    opacity: 0.92;
    transition: background 220ms ease, transform 160ms ease, opacity 220ms ease;
  }
  #quick-links a:hover { background: rgba(255,255,255,0.06); transform: translateY(-2px); }
  #quick-links a.active { background: rgba(255,255,255,0.12); font-weight: 600; }

  /* Small circular sound toggle button */
  .sound-btn {
    appearance: none;
    -webkit-appearance: none;
    border: none;
    background: rgba(255,255,255,0.06);
    color: #fff;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    cursor: pointer;
    transition: transform 150ms ease, background 180ms ease, box-shadow 180ms ease;
  }
  .sound-btn.on {
    background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(80,80,80,0.12));
    transform: translateY(-2px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.3);
  }
  .sound-btn:focus { outline: 2px solid rgba(255,255,255,0.14); outline-offset: 2px; }
  .sound-btn[aria-pressed="true"] { background: rgba(255,255,255,0.12); }

  /* Nepal clock button & popover (updated for digital + analog) */
  .clock-btn {
    appearance: none;
    -webkit-appearance: none;
    border: none;
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    color: #fff;
    padding: 6px 10px;
    border-radius: 999px;
    display: inline-flex;
    gap: 8px;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
    min-width: 64px;
    justify-content: center;
    transition: transform 160ms ease, background 180ms ease, box-shadow 180ms ease;
  }
  .clock-btn:focus { outline: 2px solid rgba(255,255,255,0.14); outline-offset: 2px; }
  .clock-btn .clock-time { font-variant-numeric: tabular-nums; font-weight:600; font-size:13px; }

  /* Blurred, side-oriented popover that holds both the digital and analog clocks */
  .clock-pop {
    position: absolute;
    right: 18px;
    top: 56px;
    background: rgba(8,8,8,0.48);
    backdrop-filter: blur(10px) saturate(1.05);
    -webkit-backdrop-filter: blur(10px) saturate(1.05);
    padding: 12px;
    border-radius: 12px;
    box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.04);
    min-width: 260px;
    z-index: 80;
    display: inline-block;

    /* entrance animation */
    opacity: 0; transform: translateY(-6px) scale(0.99); transition: opacity 220ms ease, transform 220ms ease; pointer-events: none;
  }
  .clock-pop:not([hidden]) { opacity:1; transform: translateY(0) scale(1); pointer-events: auto; }

  @media (max-width:520px) {
    .clock-pop { right: 50%; left: 50%; transform: translate(-50%,-6px) scale(0.99); width: calc(100% - 40px); min-width: unset; top: 64px; }
    .clock-pop:not([hidden]) { transform: translate(-50%,0) scale(1); }
  }

  .clock-pop-grid { display:flex; gap:12px; align-items:center; justify-content:space-between; }
  .clock-digital { flex:1 1 auto; text-align:left; padding-left:8px; }
  .clock-digital .big-time { font-size:18px; font-weight:700; letter-spacing:0.6px; color:#fff; }
  .clock-digital .tz { font-size:12px; color:rgba(255,255,255,0.75); margin-top:6px; }
  .clock-digital .clock-date { font-size:12px; color:rgba(255,255,255,0.6); margin-top:6px; }

  .clock-analog { width:120px; height:120px; display:flex; align-items:center; justify-content:center; }
  #nepal-analog { width:120px; height:120px; border-radius:12px; box-shadow: 0 8px 20px rgba(0,0,0,0.45); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); }

  .clock-pop .small-note { font-size:11px; color:rgba(255,255,255,0.55); margin-top:8px; }

  .clock-dot { width:8px;height:8px;background:linear-gradient(135deg,#ffb86b,#ff7aa2); border-radius:50%; box-shadow:0 6px 16px rgba(255,122,162,0.18); animation:pulse 1.6s infinite; }
  @keyframes pulse { 0%{ transform:scale(1); opacity:1 } 50%{ transform:scale(1.15); opacity:0.85 } 100%{ transform:scale(1); opacity:1 } }

  /* Search UI */
  .search-wrapper { position: relative; display: inline-block; }
  .search-btn { appearance: none; -webkit-appearance: none; border: none; background: rgba(255,255,255,0.06); color: #fff; width: 36px; height: 36px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; transition: transform 150ms ease, background 180ms ease, box-shadow 180ms ease; }
  .search-btn:focus { outline: 2px solid rgba(255,255,255,0.14); outline-offset: 2px; }
  .search-popover { position: absolute; right: 0; top: 44px; background: rgba(10,10,10,0.94); border-radius: 8px; padding: 10px; min-width: 260px; box-shadow: 0 10px 30px rgba(0,0,0,0.45); z-index: 12; }
  .search-popover input[type="search"] { width: 100%; padding: 8px 10px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02); color: #fff; font-size: 14px; }
  .search-results { list-style: none; margin: 8px 0 0 0; padding: 0; max-height: 220px; overflow:auto; }
  .search-result-item { padding: 8px 8px; border-radius: 6px; cursor: pointer; color: #fff; }
  .search-result-item:hover, .search-result-item:focus { background: rgba(255,255,255,0.03); outline: none; }
  .search-snippet { font-size: 13px; color: rgba(255,255,255,0.85); margin-top: 4px; }
  .search-empty { font-size: 13px; color: rgba(255,255,255,0.6); margin-top: 8px; }
  mark { background: rgba(255,255,0,0.22); color: #fff; padding: 0 2px; border-radius: 2px; }
  .search-highlight { box-shadow: 0 8px 40px rgba(255,255,0,0.06); border-radius: 8px; outline: 3px solid rgba(255,255,0,0.12); }

  /* screen-reader only helper */
  .sr-only { position:absolute; width:1px; height:1px; padding:0;margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

  /* Status overlay for diagnostics */
  #video-status {
    position: absolute;
    left: 50%;
    top: 12px;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.6);
    color: #fff;
    padding: 8px 12px;
    border-radius: 6px;
    font-family: sans-serif;
    font-size: 13px;
    z-index: 3;
    display: none;
  }

  /* Credits overlay */
  #video-overlay {
    position: absolute;
    bottom: 20px;
    right: 20px;
    background: rgba(0,0,0,0.4);
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 14px;
    font-family: sans-serif;
    z-index: 4;
    display: block;
  }

  /* Info section (main content below the video) */
  .info-section {
    position: relative;
    z-index: 2; /* above video */
    padding: 80px 20px; /* spacing from top */
    color: #fff;
  }

  .info-container {
    max-width: 1100px;
    margin: 0 auto;
    background: rgba(10,10,10,0.55);
    border-radius: 8px;
    padding: 28px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
  }

  /* individual rows: hidden by default, animate into view and have hover feedback */
  .info-row {
    display: flex;
    gap: 24px;
    align-items: center;
    margin-bottom: 28px;

    opacity: 0;
    transform: translateY(12px);
    transition: opacity 640ms cubic-bezier(.2,.9,.2,1), transform 640ms cubic-bezier(.2,.9,.2,1), box-shadow 240ms ease;
    will-change: opacity, transform;
  }

  .info-row.in-view {
    opacity: 1;
    transform: translateY(0);
  }

  .info-row:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 14px 30px rgba(0,0,0,0.35);
  }

  .info-text {
    flex: 1 1 60%;
    font-size: 16px;
    line-height: 1.6;
  }

  .info-media {
    flex: 0 0 320px;
  }

  .info-img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 6px;
    object-fit: cover;
    box-shadow: 0 8px 18px rgba(0,0,0,0.5);
    transition: transform 420ms cubic-bezier(.2,.9,.2,1);
    will-change: transform;
  }

  .info-img:hover {
    transform: scale(1.04);
  }

  /* Subtle looping blur animation on the video for a slightly dreamy effect */
  @keyframes subtleBlur {
    0% { filter: blur(0px) saturate(1) brightness(1); }
    50% { filter: blur(0.9px) saturate(1.02) brightness(0.98); }
    100% { filter: blur(0px) saturate(1) brightness(1); }
  }

  #bg-video, #bg-video2, #bg-video3 {
    /* existing properties kept above; add animation */
    animation: subtleBlur 8s ease-in-out infinite;
    will-change: transform, filter;
  }

  /* When content is visible, slightly blur & dim the video for contrast */
  .video-wrapper.blurred {
    filter: blur(2px) brightness(0.82);
    transition: filter 600ms ease;
    will-change: filter;
  }

  @media (max-width: 760px) {
    .info-row { flex-direction: column; }
    .info-media { width: 100%; }
  }
</style>
</head>
<body>

<div class="video-wrapper">
  <!-- First video -->
  <video id="bg-video" autoplay muted playsinline preload="auto" style="opacity:1">
    <source src="bagmati-overflow-4k-drone-shot-1440-publer.io.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <!-- Second video (Bagmati) ‚Äî will be used as the alternate/background clip -->
  <video id="bg-video2" autoplay muted playsinline preload="auto" style="opacity:0">
    <source src="bagmati-overflow-4k-drone-shot-1440-publer.io.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <!-- Third video (Madhesh) -->
  <video id="bg-video3" autoplay muted playsinline preload="auto" style="opacity:0">
    <source src="Untitled video - Made with Clipchamp (2).mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <div id="video-status" aria-live="polite">Loading video‚Ä¶</div> 
  <div id="video-overlay">Credits to Nepal Tourism Board</div>
</div>

<!-- Quick navigation links (jump to info sections) -->
<nav id="quick-links" class="jersey-10-regular" aria-label="Quick links">
  <a href="#info-1">Overview</a>
  <a href="#info-2">Culture</a>
  <a href="#info-3">Outdoors</a>

  <!-- Search UI (toggle + popover) -->
  <div class="search-wrapper">
    <button id="search-toggle" class="search-btn" aria-expanded="false" aria-controls="search-popover" aria-label="Search topics" title="Search topics">üîç</button>
    <div id="search-popover" class="search-popover" hidden>
      <input id="search-input" type="search" placeholder="Search topics..." aria-label="Search topics" autocomplete="off" />
      <ul id="search-results" class="search-results" role="listbox" tabindex="-1" aria-label="Search results"></ul>
      <div id="search-empty" class="search-empty" hidden>No results</div>
    </div>
  </div>

    <!-- Nepal time quick link & clock -->
    <button id="nepal-btn" class="clock-btn" aria-expanded="false" title="Show Nepal time" aria-controls="nepal-clock-pop">
      üïí <span class="clock-time">--:--</span>
    </button>
    <div id="nepal-clock-pop" class="clock-pop" hidden>
      <div class="clock-pop-grid">
        <div class="clock-digital">
          <div class="big-time" id="nepal-clock-time">--:--:--</div>
          <div class="tz">Kathmandu ¬∑ NPT (UTC+5:45)</div>
          <div class="clock-date" id="nepal-clock-date"></div>
        </div>

        <div class="clock-analog" aria-hidden="false">
          <canvas id="nepal-analog" width="120" height="120" aria-label="Analog clock"></canvas>
        </div>
      </div>
    </div>

    <!-- Small sound toggle button -->
    <button id="sound-toggle" class="sound-btn" aria-pressed="false" aria-label="Toggle sound" title="Toggle sound">üîà</button>
  </nav>

  <!-- Nishant text on the right side -->
  <div class="jersey-10-regular" style="position: fixed; right: 20px; top: 50%; transform: translateY(-50%); color: #fff; font-size: 24px; z-index: 10;">Nishant</div>

  <!-- Main scrollable content below the homepage -->
  <main class="content">
    <section class="info-section">
      <div class="info-container">

      <!-- Info item 1 -->
      <div class="info-row" id="info-1">
        <div class="info-text">
          <h2>Random things about Nepal</h2>
          <p>Nepal is a Himalayan country in South Asia, home to Mount Everest ‚Äî the highest peak on Earth. It has a rich cultural heritage, diverse ethnic groups, and a long tradition of mountain tourism and trekking.</p>
          <p>Capital: Kathmandu. Languages: Nepali and many regional languages. Known for beautiful landscapes, temples, and friendly hospitality.</p>
        </div>
        <div class="info-media">
          <!-- Add an image link here (example: paste Google image URL). Replace the src value with your image URL -->
          <img class="info-img" src="https://tse2.mm.bing.net/th/id/OIP._UNasqmNY5xyWu98GiyupAHaFM?rs=1&pid=ImgDetMain&o=7&rm=3" alt="Nepal image" loading="lazy">
        </div>
      </div>

      <!-- Info item 2 -->
      <div class="info-row" id="info-2">
        <div class="info-text">
          <h3>Culture & Festivals</h3>
          <p>Nepal celebrates many festivals such as Dashain and Tihar, which include family gatherings, rituals, and traditional music. Religious diversity includes Hinduism and Buddhism, with many historic temples and monasteries.</p>
        </div>
        <div class="info-media">
          <!-- Optional second image link: replace src with a Google image URL -->
          <img class="info-img" src="https://th.bing.com/th/id/OIP.nDmRWmh-NzqeIrKxp6d8-wHaDj?w=289&h=180&c=7&r=0&o=7&pid=1.7&rm=3" alt="Nepal festival image" loading="lazy">
        </div>
      </div>

      <!-- Info item 3 -->
      <div class="info-row" id="info-3">
        <div class="info-text">
          <h3>Outdoor Activities</h3>
          <p>Popular activities include trekking (e.g., Annapurna Circuit), mountaineering, white-water rafting, and wildlife safaris. The country offers a wide range of experiences for outdoor enthusiasts.</p>
        </div>
        <div class="info-media">
          <!-- Optional third image link: replace src with a Google image URL -->
          <img class="info-img" src="data:image/webp;base64,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" alt="Nepal outdoors image">
        </div>
      </div>

    </div>
  </section>
</main>

<!-- Background sound (toggleable) -->
<audio id="bg-sound" loop preload="auto" aria-hidden="true">
  <source src="ytmp3free.cc_dar-da-da-dasse-status-lyrics-edit-youtubemp3free.org.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script> 
// Fullscreen background video tilt (rotateX/rotateY) parallax using intrinsic video size
const video = document.getElementById('bg-video');
const status = document.getElementById('video-status');

let videoW = 0, videoH = 0;
let baseScale1 = 1; // per video
const slightCrop = 1.02; // minimal crop factor when video is already larger than viewport
const maxRotate = 10; // degrees of rotation for tilt (increased for stronger tilt)
const maxTranslate = 60; // px translation for more noticeable parallax shift (increased)

let targetRX = 0, targetRY = 0, currentRX = 0, currentRY = 0;
let targetTX = 0, targetTY = 0, currentTX = 0, currentTY = 0;
let currentVideo = video;

function showStatus(msg, show = true) {
  if (!status) return;
  status.textContent = msg;
  status.style.display = show ? 'block' : 'none';
}

const videoSrc = 'gandaki.mp4';
const srcEl = video.querySelector('source');
if (srcEl) {
  srcEl.src = videoSrc;
} else {
  const s = document.createElement('source');
  s.src = videoSrc;
  s.type = 'video/mp4';
  video.appendChild(s);
}
video.load();
showStatus('Loading video: ' + videoSrc + '...');

video.addEventListener('loadedmetadata', () => {
  videoW = video.videoWidth;
  videoH = video.videoHeight;
  // Use intrinsic width so the video is shown at its real size
  video.style.width = videoW + 'px';
  video.style.height = 'auto';
  updateBaseScale1();
  showStatus('', false);
});



video.addEventListener('canplay', () => {
  showStatus('', false);
});

video.addEventListener('error', (e) => {
  console.error('Video error', e);
  showStatus('Video failed to load. Check filename/codec or try re-encoding to H.264 MP4.', true);
  video.controls = true;
});

video.addEventListener('stalled', () => {
  showStatus('Video stalled while loading', true);
});

// Try to start playback programmatically and detect autoplay issues
video.play().catch((err) => {
  console.warn('Autoplay prevented:', err);
  showStatus('Autoplay prevented ‚Äî click to play', true);
  video.controls = true;
});

function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

let baseScale2 = 1;
let baseScale3 = 1;

function updateBaseScale1(){
  if (!videoW || !videoH) return;
  const scaleX = window.innerWidth / videoW;
  const scaleY = window.innerHeight / videoH;
  const needed = Math.max(1, Math.max(scaleX, scaleY)); // ensure video covers viewport
  baseScale1 = needed;
  // If the video is intrinsically larger than the viewport, keep its real size but apply a tiny crop to avoid visible slivers
  if (needed === 1) baseScale1 = slightCrop;
}

function updateBaseScale2(){
  const v2 = document.getElementById('bg-video2');
  if (!v2 || !v2.videoWidth || !v2.videoHeight) { baseScale2 = 1; return; }
  const scaleX = window.innerWidth / v2.videoWidth;
  const scaleY = window.innerHeight / v2.videoHeight;
  const needed = Math.max(1, Math.max(scaleX, scaleY));
  baseScale2 = needed === 1 ? slightCrop : needed;
}

function updateBaseScale3(){
  const v3 = document.getElementById('bg-video3');
  if (!v3 || !v3.videoWidth || !v3.videoHeight) { baseScale3 = 1; return; }
  const scaleX = window.innerWidth / v3.videoWidth;
  const scaleY = window.innerHeight / v3.videoHeight;
  const needed = Math.max(1, Math.max(scaleX, scaleY));
  baseScale3 = needed === 1 ? slightCrop : needed;
} 



function onMouseMove(e){
  // Normalize -1 .. 1
  const rx = (e.clientX / window.innerWidth - 0.5) * 2;
  const ry = (e.clientY / window.innerHeight - 0.5) * 2;

  // rotation mapping (invert horizontal for natural feel)
  targetRY = clamp(-rx * maxRotate, -maxRotate, maxRotate);
  targetRX = clamp(ry * maxRotate, -maxRotate, maxRotate);

  // small translation to enhance depth
  targetTX = clamp(rx * maxTranslate, -maxTranslate, maxTranslate);
  targetTY = clamp(ry * maxTranslate, -maxTranslate, maxTranslate);
}

window.addEventListener('mousemove', onMouseMove, {passive: true});

// Smooth animation loop using frame-time damping for buttery motion
let lastTime = performance.now();
function animate(now){
  const dt = Math.min(0.05, (now - lastTime) / 1000); // seconds, capped
  lastTime = now;

  // responsiveness (tweak these for feel)
  const rotSpeed = 6.5;
  const transSpeed = 8.5;

  const sRot = 1 - Math.exp(-rotSpeed * dt);
  const sTrans = 1 - Math.exp(-transSpeed * dt);

  currentRX += (targetRX - currentRX) * sRot;
  currentRY += (targetRY - currentRY) * sRot;
  currentTX += (targetTX - currentTX) * sTrans;
  currentTY += (targetTY - currentTY) * sTrans;

  // remove micro-jitter
  if (Math.abs(currentRX) < 0.0005) currentRX = 0;
  if (Math.abs(currentRY) < 0.0005) currentRY = 0;
  if (Math.abs(currentTX) < 0.02) currentTX = 0;
  if (Math.abs(currentTY) < 0.02) currentTY = 0;

  // GPU-accelerated composite transform
  let scale = 1;
  if (currentVideo === video) scale = baseScale1;
  else if (currentVideo && currentVideo.id === 'bg-video2') scale = baseScale2;
  else if (currentVideo && currentVideo.id === 'bg-video3') scale = baseScale3;
  currentVideo.style.transform = `translate3d(calc(-50% + ${currentTX}px), calc(-50% + ${currentTY}px), 0) rotateX(${currentRX}deg) rotateY(${currentRY}deg) scale(${scale})`; 

  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

window.addEventListener('resize', () => {
  updateBaseScale1();
  updateBaseScale2();
  updateBaseScale3();
});

// Reveal the info section only when the user scrolls it into view (homepage remains the video)
(function revealOnScroll(){
  const infoSection = document.querySelector('.info-section');
  if (!infoSection) return;

  // mark hidden for accessibility
  infoSection.setAttribute('aria-hidden', 'true');

  const reveal = () => {
    infoSection.classList.add('visible');
    infoSection.setAttribute('aria-hidden', 'false');
  };
  const hide = () => {
    infoSection.classList.remove('visible');
    infoSection.setAttribute('aria-hidden', 'true');
  };

  // IntersectionObserver for efficient detection
  const videoWrapper = document.querySelector('.video-wrapper');

  if ('IntersectionObserver' in window) {
    const io = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) reveal();
        else hide();
      });
    }, { threshold: 0.12 });
    io.observe(infoSection);

    // Also observe individual rows to animate them as they enter the viewport
    const rows = infoSection.querySelectorAll('.info-row');
    if (rows.length) {
      const rowObserver = new IntersectionObserver((entries) => {
        entries.forEach(en => {
          if (en.isIntersecting) en.target.classList.add('in-view');
        });
      }, { threshold: 0.2 });
      rows.forEach(r => rowObserver.observe(r));

      // also observe full sections to update quick-links active state
      const sectionObserver = new IntersectionObserver((entries) => {
        // don't set any active link until the info section is revealed
        if (!infoSection.classList.contains('visible')) {
          document.querySelectorAll('#quick-links a').forEach(a => a.classList.remove('active'));
          return;
        }

        let found = false;
        entries.forEach(en => {
          const id = en.target.id;
          const link = document.querySelector(`#quick-links a[href="#${id}"]`);
          // require a substantial intersection to consider the section 'active'
          if (en.isIntersecting && (en.intersectionRatio || 0) >= 0.5) {
            document.querySelectorAll('#quick-links a').forEach(a => a.classList.remove('active'));
            if (link) link.classList.add('active');
            found = true;
          }
        });

        if (!found) {
          document.querySelectorAll('#quick-links a').forEach(a => a.classList.remove('active'));
        }
      }, { threshold: [0.5, 0.75] });
      rows.forEach(r => { if (r.id) sectionObserver.observe(r); });
    }
  } else {
    // Fallback: simple scroll check
    const onScroll = () => {
      if (window.scrollY > window.innerHeight * 0.05) reveal();
      else hide();

      // fallback: mark rows visible when scrolled enough
      document.querySelectorAll('.info-row').forEach((r, i) => {
        if (window.scrollY > window.innerHeight * (0.2 + i * 0.05)) r.classList.add('in-view');
      });
    };
    window.addEventListener('scroll', onScroll, { passive: true });
    // run once to set initial state
    onScroll();
  }
})();

// Fallback: apply the supplied image URLs to the info items in case an inline src didn't update
(function applyProvidedImages(){
  try {
    const imgs = document.querySelectorAll('.info-img');
    if (imgs[0]) imgs[0].src = 'https://tse2.mm.bing.net/th/id/OIP._UNasqmNY5xyWu98GiyupAHaFM?rs=1&pid=ImgDetMain&o=7&rm=3';
    if (imgs[1]) imgs[1].src = 'https://th.bing.com/th/id/OIP.nDmRWmh-NzqeIrKxp6d8-wHaDj?w=289&h=180&c=7&r=0&o=7&pid=1.7&rm=3';
    if (imgs[2]) { imgs[2].src = 'https://tse1.mm.bing.net/th/id/OIP.jvdtAq3plpeZKqYKcJiW7AHaEK?rs=1&pid=ImgDetMain&o=7&rm=3'; imgs[2].loading = 'lazy'; }
  } catch(e) { console.warn('Error applying images', e); }
})();

// Small sound toggle controller
(function(){
  const audio = document.getElementById('bg-sound');
  const btn = document.getElementById('sound-toggle');
  const statusEl = document.getElementById('video-status');
  if (!audio || !btn) return;

  audio.volume = 0.8;
  let isOn = false;

  function updateButton(){
    btn.classList.toggle('on', isOn);
    btn.setAttribute('aria-pressed', String(isOn));
    btn.textContent = isOn ? 'üîä' : 'üîà';
    btn.title = isOn ? 'Sound on ‚Äî click to turn off' : 'Sound off ‚Äî click to turn on';
  }

  btn.addEventListener('click', () => {
    if (!isOn) {
      audio.play().then(() => {
        isOn = true; updateButton();
        localStorage.setItem('bgSoundOn', 'true');
      }).catch((err) => {
        console.warn('Unable to play audio:', err);
        if (statusEl) { statusEl.textContent = 'Tap to enable sound'; statusEl.style.display = 'block'; setTimeout(()=>statusEl.style.display='none',2500); }
      });
    } else {
      audio.pause();
      isOn = false; updateButton();
      localStorage.setItem('bgSoundOn', 'false');
    }
  });

  btn.addEventListener('keydown', (e) => {
    if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); btn.click(); }
  });

  // Restore saved user preference if any
  const saved = localStorage.getItem('bgSoundOn');
  if (saved === 'true') {
    audio.play().then(()=>{ isOn = true; updateButton(); }).catch(()=>{ isOn = false; updateButton(); });
  } else {
    isOn = false; updateButton();
  }
})();

// Search UI controller
(function(){
  const toggle = document.getElementById('search-toggle');
  const pop = document.getElementById('search-popover');
  const input = document.getElementById('search-input');
  const results = document.getElementById('search-results');
  const empty = document.getElementById('search-empty');
  if (!toggle || !pop || !input || !results) return;

  function openPop(){ pop.hidden = false; toggle.setAttribute('aria-expanded','true'); setTimeout(()=>input.focus(),50); }
  function closePop(){ pop.hidden = true; toggle.setAttribute('aria-expanded','false'); input.value = ''; clearResults(); toggle.focus(); }

  toggle.addEventListener('click', ()=>{ if (pop.hidden) openPop(); else closePop(); });

  // gather searchable content
  function gatherItems(){
    const rows = document.querySelectorAll('.info-row');
    return Array.from(rows).map(r => {
      const id = r.id || '';
      const titleEl = r.querySelector('h2,h3');
      const title = titleEl ? titleEl.textContent.trim() : '';
      const text = (r.querySelector('.info-text') ? r.querySelector('.info-text').innerText : r.innerText).replace(/\s+/g,' ').trim();
      return { id, title, text };
    });
  }
  const items = gatherItems();

  function clearResults(){ results.innerHTML = ''; empty.hidden = true; }

  function getSnippet(text, q){
    const idx = text.toLowerCase().indexOf(q);
    if (idx === -1) return text.slice(0,120) + (text.length>120 ? '...' : '');
    const start = Math.max(0, idx - 30);
    const end = Math.min(text.length, idx + 90);
    let s = text.slice(start, end);
    if (start > 0) s = '...' + s;
    if (end < text.length) s = s + '...';
    // highlight matches
    return s.replace(new RegExp(q, 'ig'), m => `<mark>${m}</mark>`);
  }

  function updateResults(q){
    clearResults();
    const term = q.trim().toLowerCase();
    if (!term) return;
    const matches = items.filter(it => it.title.toLowerCase().includes(term) || it.text.toLowerCase().includes(term));
    if (!matches.length) { empty.hidden = false; return; }
    matches.forEach(m => {
      const li = document.createElement('li');
      li.className = 'search-result-item';
      li.setAttribute('role','option');
      li.tabIndex = 0;
      li.innerHTML = `<strong>${m.title}</strong><div class="search-snippet">${getSnippet(m.text, term)}</div>`;
      li.addEventListener('click', () => goTo(m.id));
      li.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); goTo(m.id); } });
      results.appendChild(li);
    });
  }

  function goTo(id){
    const el = document.getElementById(id);
    if (!el) return;
    closePop();
    el.scrollIntoView({ behavior: 'smooth', block: 'start' });
    el.classList.add('search-highlight');
    setTimeout(() => el.classList.remove('search-highlight'), 2200);
  }

  input.addEventListener('input', (e) => updateResults(e.target.value));

  // keyboard & accessibility
  toggle.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle.click(); } });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && !pop.hidden) closePop(); });

  // click outside to close
  document.addEventListener('click', (e) => { if (!pop.hidden && !pop.contains(e.target) && e.target !== toggle) closePop(); });

})();

// Video switching controller
(function(){
  const video1 = document.getElementById('bg-video');
  const video2 = document.getElementById('bg-video2'); // may be null
  const video3 = document.getElementById('bg-video3'); // may be null

  if (!video1) return;

  // ensure the global currentVideo (used by animate) points to the active element
  currentVideo = video1;

  function switchToVideo(nextVideo) {
    if (!nextVideo || currentVideo === nextVideo) return;
    if (currentVideo) currentVideo.style.opacity = '0';
    nextVideo.style.opacity = '1';
    setTimeout(() => {
      if (currentVideo) { try { currentVideo.pause(); currentVideo.currentTime = 0; } catch(e){} }
      nextVideo.play().catch(err => console.warn('Video play error:', err));
      currentVideo = nextVideo;
    }, 1000);
  }

  if (video2) {
    if (video3) {
      // 3-video sequence: 1 -> 2 -> 3 -> 1
      video1.addEventListener('ended', () => switchToVideo(video2));
      video2.addEventListener('ended', () => switchToVideo(video3));
      video3.addEventListener('ended', () => switchToVideo(video1));

      video2.addEventListener('loadedmetadata', updateBaseScale2);
      video3.addEventListener('loadedmetadata', updateBaseScale3);
      updateBaseScale2(); updateBaseScale3();
    } else {
      // 2-video sequence remains: 1 <-> 2
      video1.addEventListener('ended', () => switchToVideo(video2));
      video2.addEventListener('ended', () => switchToVideo(video1));
      video2.addEventListener('loadedmetadata', updateBaseScale2);
      updateBaseScale2();
    }
  } else {
    // single-video fallback: loop so it doesn't go blank after ending
    video1.loop = true;
  }

  // Start with video1 playing
  video1.play().catch(err => console.warn('Video1 play error:', err));
})();

// Nepal clock controller (digital + analog)
(function(){
  const btn = document.getElementById('nepal-btn');
  const pop = document.getElementById('nepal-clock-pop');
  const timeEl = document.getElementById('nepal-clock-time');
  const dateEl = document.getElementById('nepal-clock-date');
  const canvas = document.getElementById('nepal-analog');
  const ctx = canvas ? canvas.getContext('2d') : null;
  const NEPAL_OFFSET_MIN = 5*60 + 45; // +5:45

  function toNepalDate(date){
    const utc = date.getTime() + (date.getTimezoneOffset() * 60000);
    return new Date(utc + NEPAL_OFFSET_MIN * 60000);
  }

  function sizeCanvas(){
    if (!canvas || !ctx) return;
    const size = 120;
    const ratio = window.devicePixelRatio || 1;
    canvas.style.width = size + 'px';
    canvas.style.height = size + 'px';
    canvas.width = size * ratio;
    canvas.height = size * ratio;
    ctx.setTransform(ratio,0,0,ratio,0,0);
  }

  function drawAnalog(d){
    if (!ctx) return;
    const w = canvas.width / (window.devicePixelRatio || 1);
    const h = canvas.height / (window.devicePixelRatio || 1);
    ctx.clearRect(0,0,w,h);
    const cx = w/2, cy = h/2, radius = Math.min(w,h) * 0.45;

    // subtle dial background
    const g = ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0, 'rgba(255,255,255,0.02)');
    g.addColorStop(1, 'rgba(255,255,255,0.01)');
    ctx.fillStyle = g;
    ctx.beginPath(); ctx.arc(cx,cy,radius+6,0,Math.PI*2); ctx.fill();

    // outer ring
    ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.arc(cx,cy,radius,0,Math.PI*2); ctx.stroke();

    // ticks
    for (let i=0;i<60;i++){
      const ang = (Math.PI*2) * (i/60) - Math.PI/2;
      const inner = radius - (i%5?6:12);
      const outer = radius - 2;
      ctx.strokeStyle = i%5 ? 'rgba(255,255,255,0.06)' : 'rgba(255,255,255,0.14)';
      ctx.lineWidth = i%5 ? 1 : 2;
      ctx.beginPath(); ctx.moveTo(cx+Math.cos(ang)*inner, cy+Math.sin(ang)*inner); ctx.lineTo(cx+Math.cos(ang)*outer, cy+Math.sin(ang)*outer); ctx.stroke();
    }

    const hh = d.getUTCHours() % 12;
    const mm = d.getUTCMinutes();
    const ss = d.getUTCSeconds();
    const hourAngle = (Math.PI*2) * ((hh*60 + mm) / (12*60)) - Math.PI/2;
    const minAngle = (Math.PI*2) * ((mm*60 + ss) / 3600) - Math.PI/2;
    const secAngle = (Math.PI*2) * (ss/60) - Math.PI/2;

    // hour hand
    ctx.strokeStyle = 'rgba(255,255,255,0.95)'; ctx.lineWidth = 4; ctx.lineCap = 'round';
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx + Math.cos(hourAngle) * (radius * 0.52), cy + Math.sin(hourAngle) * (radius * 0.52)); ctx.stroke();
    // minute
    ctx.strokeStyle = 'rgba(255,255,255,0.95)'; ctx.lineWidth = 3;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx + Math.cos(minAngle) * (radius * 0.72), cy + Math.sin(minAngle) * (radius * 0.72)); ctx.stroke();
    // second
    ctx.strokeStyle = 'rgba(255,120,162,0.95)'; ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx + Math.cos(secAngle) * (radius * 0.82), cy + Math.sin(secAngle) * (radius * 0.82)); ctx.stroke();

    // center hub
    ctx.fillStyle = 'rgba(255,255,255,0.95)'; ctx.beginPath(); ctx.arc(cx,cy,3,0,Math.PI*2); ctx.fill();
  }

  function update(){
    try {
      const now = new Date();
      const nepal = toNepalDate(now);
      const timeFmt = new Intl.DateTimeFormat(undefined, { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZone:'Asia/Kathmandu' });
      const dateFmt = new Intl.DateTimeFormat(undefined, { weekday:'short', month:'short', day:'numeric', timeZone:'Asia/Kathmandu' });
      const timeStr = timeFmt.format(nepal);
      const dateStr = dateFmt.format(nepal);
      if (timeEl) timeEl.textContent = timeStr;
      if (dateEl) dateEl.textContent = dateStr;
      const small = document.querySelector('#nepal-btn .clock-time');
      if (small) small.textContent = timeStr.replace(/:\\d{2}$/, '');

      if (canvas) drawAnalog(nepal);
    } catch(e){ console.warn('Nepal clock error', e); }
  }

  // initialize
  sizeCanvas();
  update();
  setInterval(update, 1000);
  window.addEventListener('resize', sizeCanvas);

  if (!btn || !pop) return;
  btn.addEventListener('click', (e) => {
    const show = pop.hidden;
    pop.hidden = !show;
    btn.setAttribute('aria-expanded', String(show));
    if (show) pop.querySelector('button')?.focus?.();
  });

  // close when clicking outside
  document.addEventListener('click', (e) => {
    // Consider clicks inside the popover or inside the toggle button as 'inside'
    if (!pop.hidden && !pop.contains(e.target) && !btn.contains(e.target)) {
      pop.hidden = true; btn.setAttribute('aria-expanded','false');
    }
  });

  // close on escape
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && !pop.hidden) { pop.hidden = true; btn.setAttribute('aria-expanded','false'); } });
})();

</script>

</body>
</html>
