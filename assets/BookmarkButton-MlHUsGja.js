import{r as u,j as s}from"./vendor-ui-QgVN0H1W.js";import{h as j,u as S,s as m,B as f,L as g}from"./index-z_EbRe_p.js";import{B as p}from"./markdownParser-CvRXSPA6.js";import{B as v}from"./Navbar-CS4KFtzu.js";function _(i,c){const{user:a}=j(),{toast:n}=S(),[t,o]=u.useState(!1),[d,r]=u.useState(!1),[h,x]=u.useState(null);u.useEffect(()=>{a&&i&&w()},[a,i]);const w=async()=>{if(!(!a||!i))try{const{data:e}=await m.from("places").select("id").eq("name",i).maybeSingle();if(e){x(e.id);const{data:l}=await m.from("saved_places").select("id").eq("user_id",a.id).eq("place_id",e.id).maybeSingle();o(!!l)}}catch(e){console.error("Error checking saved status:",e)}},b=u.useCallback(async()=>{if(!a){n({title:"Please sign in to save places"});return}if(i){r(!0);try{let e=h;if(!e){const{data:l,error:k}=await m.from("places").insert({name:i,description:c?.description||null,category:c?.category||null,image_url:c?.image_url||null,location:c?.location||null}).select("id").single();if(k)throw k;e=l.id,x(e)}if(t){const{error:l}=await m.from("saved_places").delete().eq("user_id",a.id).eq("place_id",e);if(l)throw l;o(!1),n({title:"Removed from saved places"})}else{const{error:l}=await m.from("saved_places").insert({user_id:a.id,place_id:e});if(l)throw l;o(!0),n({title:"Added to saved places! â­"})}}catch(e){n({variant:"destructive",title:"Error",description:e.message})}finally{r(!1)}}},[a,i,h,t,c,n]);return{isSaved:t,loading:d,toggleSave:b}}const E=({placeName:i,placeData:c,variant:a="icon",className:n=""})=>{const{isSaved:t,loading:o,toggleSave:d}=_(i,c);return a==="overlay"?s.jsx(f,{variant:"ghost",size:"icon",onClick:r=>{r.preventDefault(),r.stopPropagation(),d()},disabled:o,className:`bg-background/80 backdrop-blur-sm hover:bg-background/90 ${t?"text-nepal-gold":"text-foreground"} ${n}`,children:o?s.jsx(g,{className:"w-4 h-4 animate-spin"}):t?s.jsx(p,{className:"w-4 h-4"}):s.jsx(v,{className:"w-4 h-4"})}):a==="full"?s.jsxs(f,{variant:"outline",onClick:r=>{r.preventDefault(),r.stopPropagation(),d()},disabled:o,className:`${t?"text-nepal-gold border-nepal-gold":""} ${n}`,children:[o?s.jsx(g,{className:"w-4 h-4 animate-spin mr-2"}):t?s.jsx(p,{className:"w-4 h-4 mr-2"}):s.jsx(v,{className:"w-4 h-4 mr-2"}),t?"Saved":"Save"]}):s.jsx(f,{variant:"ghost",size:"icon",onClick:r=>{r.preventDefault(),r.stopPropagation(),d()},disabled:o,className:`${t?"text-nepal-gold":""} ${n}`,children:o?s.jsx(g,{className:"w-4 h-4 animate-spin"}):t?s.jsx(p,{className:"w-4 h-4"}):s.jsx(v,{className:"w-4 h-4"})})};export{E as B};
