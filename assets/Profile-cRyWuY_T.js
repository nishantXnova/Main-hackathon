import{r,j as e}from"./vendor-ui-QgVN0H1W.js";import{c as d,h as O,u as q,s as i,L as c,I as k,B as o}from"./index-z_EbRe_p.js";import{N as B,S as Y,B as D}from"./Navbar-CS4KFtzu.js";import{F as I}from"./Footer-BVpW2v9u.js";import{c as $,L as z}from"./vendor-react-GoYkDhlm.js";import{m as H}from"./vendor-motion-7Gg7V_LS.js";import{U as S}from"./gonepallogo-Cu4Fv82l.js";import{M as V}from"./mail-DMF2ambA.js";import{S as R}from"./save-Bz55BveC.js";import"./vendor-charts-K-ahvkCb.js";import"./newspaper-Bh7e0O0f.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=d("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=d("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=d("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),ie=()=>{const{user:s,signOut:E,isAdmin:m}=O(),{toast:l}=q(),L=$(),[u,h]=r.useState(null),[C,P]=r.useState(!0),[x,f]=r.useState(!1),[p,g]=r.useState(!1),[n,y]=r.useState("");r.useEffect(()=>{s&&F()},[s]);const F=async()=>{try{const{data:a,error:t}=await i.from("profiles").select("*").eq("id",s?.id).single();if(t)throw t;h(a),y(a.full_name||"")}catch(a){console.error("Error fetching profile:",a)}finally{P(!1)}},A=async a=>{try{if(g(!0),!a.target.files||a.target.files.length===0)throw new Error("You must select an image to upload.");const t=a.target.files[0],_=t.name.split(".").pop(),v=`${s?.id}-${Math.random()}.${_}`,{error:j}=await i.storage.from("avatars").upload(v,t);if(j)throw j;const{data:{publicUrl:N}}=i.storage.from("avatars").getPublicUrl(v),{error:b}=await i.from("profiles").update({avatar_url:N}).eq("id",s?.id);if(b)throw b;h(w=>w?{...w,avatar_url:N}:null),l({title:"Profile picture updated",description:"Your new profile picture has been uploaded successfully."})}catch(t){l({variant:"destructive",title:"Upload failed",description:t.message})}finally{g(!1)}},U=async()=>{if(s){f(!0);try{const{error:a}=await i.from("profiles").update({full_name:n.trim()}).eq("id",s.id);if(a)throw a;l({title:"Profile updated",description:"Your profile has been saved successfully."})}catch(a){l({variant:"destructive",title:"Error",description:a.message})}finally{f(!1)}}},M=async()=>{await E(),l({title:"Signed out",description:"You have been signed out successfully."})};return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(c,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{}),e.jsx("main",{className:"container-wide pt-24 pb-16",children:e.jsxs(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"heading-section text-3xl mb-8",children:"My Profile"}),e.jsxs("div",{className:"glass-effect rounded-2xl p-8 shadow-card space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:p?e.jsx(c,{className:"w-8 h-8 animate-spin text-primary"}):u?.avatar_url?e.jsx("img",{src:u.avatar_url,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(S,{className:"w-12 h-12 text-primary"})}),e.jsxs("label",{htmlFor:"avatar-upload",className:"absolute bottom-0 right-0 p-2 bg-primary text-primary-foreground rounded-full hover:bg-primary/90 transition-colors cursor-pointer shadow-soft",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("input",{type:"file",id:"avatar-upload",className:"hidden",accept:"image/*",onChange:A,disabled:p})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:n||"Add your name"}),e.jsx("p",{className:"text-muted-foreground",children:s?.email}),m&&e.jsxs("span",{className:"inline-flex items-center gap-1 mt-2 px-2 py-1 bg-primary/10 text-primary text-xs font-medium rounded-full",children:[e.jsx(Y,{className:"w-3 h-3"}),"Admin"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(k,{value:n,onChange:a=>y(a.target.value),placeholder:"Enter your full name",className:"pl-10",maxLength:100})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(k,{value:s?.email||"",disabled:!0,className:"pl-10 bg-muted"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Email cannot be changed"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(o,{onClick:U,disabled:x,className:"btn-primary flex-1",children:x?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Save Changes"]})}),e.jsx(z,{to:"/saved-places",className:"flex-1",children:e.jsxs(o,{variant:"outline",className:"w-full",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Saved Places"]})})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"border-border"}),e.jsxs(o,{variant:"outline",onClick:()=>L("/admin"),className:"w-full",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Admin Dashboard"]})]}),e.jsx("hr",{className:"border-border"}),e.jsxs(o,{variant:"outline",onClick:M,className:"w-full text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})]})}),e.jsx(I,{})]})};export{ie as default};
